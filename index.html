<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AMC8/10/12 Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    ::selection {
      background-color: #c7d2fe;
      color: #1e3a8a;
    }

    .hover-scale:hover {
      transform: scale(1.03);
      transition: transform 0.2s ease;
    }

    .tooltip {
      position: absolute;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #fef9c3;
      color: #92400e;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s ease;
      font-size: 0.75rem;
      pointer-events: none;
      z-index: 20;
      pointer-events: none;
    white-space: nowrap;
     max-width: 200px;
    }

    .group:hover .tooltip {
      opacity: 1;
    }

    th {
      position: sticky;
      top: 0;
      background: #e0f2fe;
    }

    .glass {
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body class="bg-white text-gray-800 p-4 sm:p-6 min-h-screen">
  <div class="max-w-6xl mx-auto space-y-10">
    <header class="glass p-6 sm:p-8 rounded-[2rem] text-center shadow-xl">
      <h1 class="text-4xl font-bold text-blue-900 tracking-tight">📚 AMC8/10/12 Tracker</h1>
      <p class="text-sm text-blue-700 mt-2">Track your progress, earn badges, and level up your math skills!</p>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <section class="glass p-6 rounded-2xl shadow-xl">
        <h2 class="text-xl font-semibold text-blue-700 mb-4">🎮 Gamification Panel</h2>
        <div class="flex justify-between items-center mb-3">
          <div class="text-lg">🔥 <strong>Streak:</strong> <span id="streakCount">0</span> days</div>
          <div class="text-lg">
            ⭐ <strong>XP:</strong> <span id="xpCount">0</span><br>
            🧩 <strong>Level:</strong> <span id="levelCount">1</span>
          </div>
        </div>
        <div class="w-full bg-gray-200 h-6 rounded-full overflow-hidden">
          <div id="xpProgressBar" class="bg-gradient-to-r from-blue-500 to-indigo-600 h-full text-white text-sm text-center leading-6 transition-all duration-300 ease-in-out">0%</div>
        </div>
        <div class="text-sm text-gray-600 mt-2 text-right">🎯 Daily XP Goal: <span id="dailyGoal">100</span> XP</div>

        <!-- Wheel Chart Section -->
        <div class="mt-6">
          <h3 class="text-md font-semibold text-blue-800 mb-2">📌 Problem Distribution</h3>
          <div class="w-full max-w-md mx-auto">
  <canvas id="problemWheel" class="w-full h-auto"></canvas>
</div>

        </div>
      </section>

      <section class="glass p-6 rounded-2xl shadow-xl">
        <h2 class="text-xl font-semibold text-blue-700 mb-4">📄 New Test Entry</h2>
        <div class="space-y-4">
          <select id="testType" class="w-full border border-blue-300 rounded p-2">
            <option value="amc8">AMC 8</option>
            <option value="amc10">AMC 10</option>
            <option value="amc12">AMC 12</option>
          </select>

          <input type="number" id="testYear" min="2000" max="2099" class="w-full border border-blue-300 rounded p-2" placeholder="Enter Year (e.g., 2025)">

          <textarea id="userAnswers" rows="2" oninput="sanitizeInput(this)" class="w-full border border-blue-300 rounded p-2" placeholder="Enter Your Answers (25 letters A–E only)"></textarea>

          <textarea id="answerKeyInput" rows="2" oninput="sanitizeInput(this)" class="w-full border border-blue-300 rounded p-2" placeholder="Enter Official Answer Key (25 letters A–E only)"></textarea>

          <div class="flex items-center justify-between">
            <button onclick="autoExtractAoPS()" class="text-sm text-blue-600 hover:underline hover-scale">✨ Auto-Extract from AoPS</button>
            <button onclick="gradeTest()" class="bg-blue-600 text-white px-4 py-2 rounded-full hover:scale-105 hover:bg-blue-700 transition">Grade Test</button>
          </div>

          <div id="result" class="mt-2 text-green-700 font-semibold"></div>
        </div>
      </section>

      <section class="glass p-6 rounded-2xl shadow-xl">
        <h2 class="text-xl font-semibold text-indigo-700 mb-4">📊 Test Statistics</h2>
        <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
          <li>Total Tests Taken: <span id="stat-total">0</span></li>
          <li>Last Test Date: <span id="stat-last">—</span></li>
          <li>Average Score: <span id="stat-avg">—</span></li>
          <li>Best Score: <span id="stat-best">—</span></li>
        </ul>
      </section>

      <section class="glass p-6 rounded-2xl shadow-xl">
        <h2 class="text-xl font-semibold text-yellow-700 mb-4">🏅 Badges Earned</h2>
        <div id="badges" class="flex gap-3 items-center flex-wrap text-2xl">No badges yet</div>
      </section>

      <section class="glass p-6 rounded-2xl shadow-xl col-span-1 lg:col-span-2">
        <h2 class="text-xl font-semibold text-blue-700 mb-2">📝 Past Tests</h2>
        <div class="max-h-64 overflow-y-auto">
          <table class="w-full table-auto text-sm text-gray-700">
            <thead>
              <tr>
                <th class="px-3 py-2 text-left">Date</th>
                <th class="px-3 py-2 text-left">Score</th>
                <th class="px-3 py-2 text-left">Percent</th>
                <th class="px-3 py-2 text-left">Test Type</th>
                <th class="px-3 py-2 text-left">Year</th>
              </tr>
            </thead>
            <tbody id="pastTestsBody" class="divide-y divide-gray-200"></tbody>
          </table>
          <p id="noTestsMsg" class="text-gray-500 mt-2 text-center">📭 No tests yet — start solving!</p>
        </div>
      </section>

      <section class="glass p-6 rounded-2xl shadow-xl col-span-1 lg:col-span-2">
        <h2 class="text-xl font-semibold text-blue-700 mb-4">📈 Score Progress</h2>
        <canvas id="scoreChart" height="150"></canvas>
      </section>
      <section class="glass p-6 rounded-2xl shadow-xl col-span-1 lg:col-span-2">
  <h2 class="text-xl font-semibold text-green-700 mb-4">📌 Question Accuracy</h2>
  <div class="overflow-x-auto">
    <table class="w-full table-auto text-sm text-gray-800 text-center">
      <thead>
        <tr>
          <th class="px-2 py-1">Q#</th>
          <th class="px-2 py-1">Correct</th>
          <th class="px-2 py-1">Total</th>
          <th class="px-2 py-1">Accuracy (%)</th>
        </tr>
      </thead>
      <tbody id="questionAccuracyBody" class="divide-y divide-gray-200"></tbody>
    </table>
  </div>
</section>

      <div class="text-center col-span-full">
        <button onclick="clearData()" class="text-sm text-red-600 hover:underline hover-scale">🔄 Reset All Data</button>
      </div>
    </main>
  </div>
  <!-- JavaScript Logic -->
  <script>
    const xpEl = document.getElementById("xpCount");
    const streakEl = document.getElementById("streakCount");
    const totalEl = document.getElementById("stat-total");
    const lastEl = document.getElementById("stat-last");
    const avgEl = document.getElementById("stat-avg");
    const bestEl = document.getElementById("stat-best");
    const badgeEl = document.getElementById("badges");
    const xpProgressBar = document.getElementById("xpProgressBar");
    const dailyGoal = 100;
    const pastTestsBody = document.getElementById("pastTestsBody");
    const noTestsMsg = document.getElementById("noTestsMsg");
    let scores = JSON.parse(localStorage.getItem("scores") || "[]");
    const problemWheel = document.getElementById("problemWheel").getContext("2d");
    let totalCorrect = 0;
    let totalWrong = 0;
    let questionStats = JSON.parse(localStorage.getItem("questionStats") || "[]");
if (questionStats.length !== 25) {
  questionStats = Array(25).fill().map(() => ({ correct: 0, total: 0 }));
}

     function updateWheel() {
  const totalProblems = totalCorrect + totalWrong;

  const hasData = totalProblems > 0;

  const wheelData = {
    labels: ["Correct", "Incorrect"],
    datasets: [{
      data: hasData ? [totalCorrect, totalWrong] : [1],  // Fallback to show a placeholder
      backgroundColor: hasData ? ["#10b981", "#ef4444"] : ["#d1d5db"], // green/red or gray
      borderColor: "#ffffff",
      borderWidth: 2
    }]
  };

  if (window.problemChart) window.problemChart.destroy();

  window.problemChart = new Chart(problemWheel, {
    type: "doughnut",
    data: wheelData,
    options: {
  maintainAspectRatio: true,
  aspectRatio: 1, // Keeps it square
  cutout: "70%",
  plugins: {
    legend: {
      position: "bottom"
    }
  }
}

  });
}

updateWheel();
    const originalGradeTest = gradeTest;

    function updateStreak() {
      const today = new Date().toISOString().split("T")[0];
      const lastDate = localStorage.getItem("lastPracticeDate");
      let streak = parseInt(localStorage.getItem("streak") || "0");

      if (lastDate !== today) {
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yStr = yesterday.toISOString().split("T")[0];
        streak = lastDate === yStr ? streak + 1 : 1;
        localStorage.setItem("lastPracticeDate", today);
        localStorage.setItem("streak", streak);
      }

      streakEl.textContent = streak;
    }

    function updateXP(amount) {
      let xp = parseInt(localStorage.getItem("xp") || "0");
      xp += amount;
      localStorage.setItem("xp", xp);
      xpEl.textContent = xp;

      const percent = Math.min(100, Math.round((xp % dailyGoal) / dailyGoal * 100));
      xpProgressBar.style.width = percent + "%";
      xpProgressBar.textContent = percent + "%";

      const level = Math.floor(xp / 100) + 1;
      document.getElementById("levelCount").textContent = level;
    }

    function updateStats() {
      const total = scores.length;
      const best = Math.max(...scores.map(s => s.score), 0);
      const avg = scores.reduce((acc, s) => acc + s.score, 0) / (scores.length || 1);
      const last = scores.length ? scores[scores.length - 1].date : "—";

      totalEl.textContent = total;
      bestEl.textContent = best;
      avgEl.textContent = Math.round(avg * 100) / 100;
      lastEl.textContent = last;
    }

    function gradeTest() {
  const input = document.getElementById("userAnswers").value.trim().toUpperCase();
  const key = document.getElementById("answerKeyInput").value.trim().toUpperCase();
  const testType = document.getElementById("testType").value;
  const testYear = document.getElementById("testYear").value || new Date().getFullYear();

  if (input.length !== 25 || key.length !== 25) {
    document.getElementById("result").innerHTML = `❌ You must enter exactly 25 characters in both fields (A–E only).`;
    return;
  }

  let correct = 0;
  for (let i = 0; i < 25; i++) {
    if (input[i] === key[i]) correct++;
  }
let incorrectIndexes = [];

for (let i = 0; i < 25; i++) {
  if (input[i] === key[i]) {
    questionStats[i].correct++;
  } else {
    incorrectIndexes.push(i + 1); // 1-based index
  }
  questionStats[i].total++;
}

localStorage.setItem("questionStats", JSON.stringify(questionStats));
renderQuestionAccuracy();

  const incorrect = 25 - correct;
  const percent = Math.round((correct / 25) * 100);
  const score = correct;
  const date = new Date().toISOString().split("T")[0];

  scores.push({ date, score, testType, year: parseInt(testYear), wrong: incorrectIndexes });
  localStorage.setItem("scores", JSON.stringify(scores));

  document.getElementById("result").innerHTML = `✅ You scored <strong>${score}</strong> out of <strong>25</strong>.<br>✔️ Correct: ${correct} | ❌ Incorrect: ${incorrect} | 📈 ${percent}%`;

  // Update wheel chart
  totalCorrect += correct;
  totalWrong += incorrect;
  updateWheel();

  // Update gamification & statistics
  updateStreak();
  updateXP(10 + correct); // XP bonus: 10 base + 1 per correct answer
  updateStats();
  renderChart();
  updateBadges(score);
  renderPastTests();
}

    function sanitizeInput(textarea) {
      textarea.value = textarea.value.toUpperCase().replace(/[^ABCDE]/g, '').slice(0, 25);
    }

    function clearData() {
  if (confirm("Are you sure you want to reset all saved data?")) {
    localStorage.removeItem("scores");
    localStorage.removeItem("xp");
    localStorage.removeItem("streak");
    localStorage.removeItem("lastPracticeDate");
    localStorage.removeItem("questionStats"); // ✅ This line resets question accuracy
    location.reload();
  }
}


    function autoExtractAoPS() {
      const input = document.getElementById("answerKeyInput").value;
      const matches = input.toUpperCase().match(/[ABCDE]/g);
      if (matches && matches.length >= 25) {
        document.getElementById("answerKeyInput").value = matches.slice(0, 25).join("");
        alert("✅ Answer key extracted successfully!");
      } else {
        alert("❌ Couldn't extract 25 valid answers from input.");
      }
    }

    function updateBadges(latestScore) {
      const streak = parseInt(localStorage.getItem("streak") || "0");
      let badges = [];

      if (streak >= 3) badges.push({ emoji: "🥉", title: "3-Day Streak" });
      if (streak >= 7) badges.push({ emoji: "🥈", title: "7-Day Streak" });
      if (streak >= 30) badges.push({ emoji: "🥇", title: "30-Day Streak" });
      if (streak >= 100) badges.push({ emoji: "🔥", title: "100-Day Streak" });
      if (latestScore === 25) badges.push({ emoji: "💯", title: "Perfect Score" });
      if (scores.length > 1) {
        const prevScore = scores[scores.length - 2].score;
        if (latestScore - prevScore >= 5) badges.push({ emoji: "🚀", title: "Big Improvement" });
        if (latestScore === prevScore) badges.push({ emoji: "🎯", title: "Consistent Score" });
      }
      const best = Math.max(...scores.map(s => s.score), 0);
      if (latestScore === best && latestScore !== 0) badges.push({ emoji: "⏫", title: "New Personal Best" });
      if (latestScore >= 20) badges.push({ emoji: "🧠", title: "High Score" });
      const totalTests = scores.length;
      if (totalTests >= 5) badges.push({ emoji: "📚", title: "5 Tests Taken" });
      if (totalTests >= 10) badges.push({ emoji: "📝", title: "10 Tests Taken" });
      if (totalTests >= 25) badges.push({ emoji: "🧪", title: "25 Tests Taken" });

      badgeEl.innerHTML = badges.length
        ? badges.map(b => `
            <div class="relative group hover-scale">
              <span class="cursor-pointer">${b.emoji}</span>
              <div class="tooltip">${b.title}</div>
            </div>
          `).join("")
        : "<p class='text-sm text-gray-500'>No badges yet</p>";
    }

    function renderChart() {
      const ctx = document.getElementById("scoreChart").getContext("2d");
      const labels = scores.map(s => s.date);
      const data = scores.map(s => s.score);

      if (window.chart) window.chart.destroy();

      window.chart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Score",
            data,
            borderColor: "#2563eb",
            backgroundColor: "rgba(37,99,235,0.1)",
            tension: 0.2,
            fill: true
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              max: 25
            }
          }
        }
      });
    }

    function renderPastTests() {
      if (scores.length === 0) {
        noTestsMsg.style.display = "block";
        pastTestsBody.innerHTML = "";
        return;
      }

      noTestsMsg.style.display = "none";

      pastTestsBody.innerHTML = scores
  .map(t => {
    const percent = Math.round((t.score / 25) * 100);
    const dateStr = t.date;
    const testTypeLabel = t.testType ? t.testType.toUpperCase() : "-";
    const wrongList = t.wrong?.length ? t.wrong.join(", ") : "None";
    return `
      <tr class="group relative hover:bg-blue-50 transition">
        <td class="px-3 py-1">${dateStr}</td>
        <td class="px-3 py-1">${t.score} / 25</td>
        <td class="px-3 py-1">${percent}%</td>
        <td class="px-3 py-1 capitalize">${testTypeLabel}</td>
        <td class="px-3 py-1">${t.year || '—'}</td>
        <td class="absolute left-1/2 -translate-x-1/2 -top-12 z-50 bg-yellow-100 text-yellow-900 text-xs px-3 py-2 rounded shadow max-w-sm w-fit text-center opacity-0 group-hover:opacity-100 transition pointer-events-none break-words whitespace-normal">
    ❌ Missed: ${wrongList}
  </td>
      </tr>
    `;
  })
  .join("");

    }
    function renderQuestionAccuracy() {
  const tbody = document.getElementById("questionAccuracyBody");
  tbody.innerHTML = questionStats.map((q, i) => {
    const accuracy = q.total ? Math.round((q.correct / q.total) * 100) : '—';
    return `
      <tr>
        <td class="px-2 py-1 font-medium">${i + 1}</td>
        <td class="px-2 py-1 text-green-700">${q.correct}</td>
        <td class="px-2 py-1">${q.total}</td>
        <td class="px-2 py-1">${accuracy}%</td>
      </tr>
    `;
  }).join('');
}

    // Init
    updateStreak();
    xpEl.textContent = localStorage.getItem("xp") || "0";
    updateXP(0);
    document.getElementById("levelCount").textContent = Math.floor((parseInt(localStorage.getItem("xp") || "0")) / 100) + 1;
    updateStats();
    renderChart();
    const latest = scores[scores.length - 1]?.score || 0;
    updateBadges(latest);
    renderPastTests();
    renderQuestionAccuracy();

  </script>
</body>
</html>
