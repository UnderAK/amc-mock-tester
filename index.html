<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <meta name="google-adsense-account" content="ca-pub-4838386058993800">
  <meta charset="UTF-8" />
  <title>AMC8/10/12 Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
  body {
    font-family: 'Inter', sans-serif;
  }

  ::selection {
    background-color: #c7d2fe;
    color: #1e3a8a;
  }

  .hover-scale:hover {
    transform: scale(1.03);
    transition: transform 0.2s ease;
  }

  .tooltip {
    position: absolute;
    bottom: 120%;
    left: 50%;
    transform: translateX(-50%);
    background-color: #fef9c3;
    color: #92400e;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.2s ease;
    font-size: 0.75rem;
    pointer-events: none;
    z-index: 20;
    max-width: 200px;
  }

  .group:hover .tooltip {
    opacity: 1;
  }

  th {
    position: sticky;
    top: 0;
    background: #e0f2fe;
  }

  .glass {
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }
  html:not(.dark) thead.bg-blue-100 {
  background-color: #bfdbfe; /* solid light blue */
  color: #1e293b;
  font-weight: 600;
}

html:not(.dark) #questionAccuracyBody td {
  color: #1e293b;
}

html:not(.dark) #questionAccuracyBody tr:hover {
  background-color: rgba(59, 130, 246, 0.08);
}

/* Dark mode - Question Accuracy table fix */
html.dark thead.bg-blue-100 {
  background-color: #1e3a8a;
  color: #cbd5e1;
  font-weight: 600;
}

html.dark #questionAccuracyBody td {
  color: #e2e8f0;
}

html.dark #questionAccuracyBody tr:hover {
  background-color: rgba(96, 165, 250, 0.15);
}
  /* DARK MODE STYLES */
  .dark {
    background-color: #0f172a;
    color: #f1f5f9;
  }

  .dark body {
    background-color: #0f172a;
    color: #f1f5f9;
  }

  .dark .glass {
    background: rgba(30, 41, 59, 0.5);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(255, 255, 255, 0.05);
  }

  .dark th {
    background: #1e293b;
    color: #e2e8f0;
  }

  .dark select,
  .dark input,
  .dark textarea {
    background-color: #1e293b;
    color: #f8fafc;
    border-color: #334155;
  }

  .dark body,
.dark .force-dark-bg {
  background-color: #0f172a;
}


  .dark .text-gray-700,
  .dark .text-gray-600,
  .dark .text-gray-500,
  .dark .text-blue-700,
  .dark .text-indigo-700,
  .dark .text-yellow-700,
  .dark .text-green-700 {
    color: #cbd5e1 !important;
  }

  .dark .text-blue-900 {
    color: #c7d2fe;
  }
  .dark td {
  color: #e2e8f0;
}

.dark tr:hover {
  background-color: rgba(30, 64, 175, 0.2);
}

.dark .divide-gray-200 {
  border-color: #334155;
}

  .dark .tooltip {
    background-color: #fde68a;
    color: #1e293b;
  }

  .dark .hover\:bg-blue-50:hover {
    background-color: #1e3a8a2b;
  }

  .dark .bg-gray-200 {
    background-color: #1e293b;
  }

  .dark .text-white {
    color: #f8fafc;
  }

  .dark .border-blue-300 {
    border-color: #475569;
  }

  .dark .bg-gray-700 {
    background-color: #1f2937;
  }

  .dark .bg-indigo-600 {
    background-color: #4f46e5;
  }

  .dark .bg-yellow-100 {
    background-color: #fef08a;
    color: #1e293b;
  }

  .dark .text-yellow-900 {
    color: #1e293b;
  }

  .dark .bg-blue-600 {
    background-color: #2563eb;
  }

  .dark .hover\:bg-blue-700:hover {
    background-color: #1d4ed8;
  }

  .dark .bg-gradient-to-r {
    background-image: linear-gradient(to right, #3b82f6, #6366f1);
  }


  .dark .shadow-xl {
    box-shadow: 0 10px 15px rgba(255, 255, 255, 0.05);
  }

  .dark .bg-black {
    background-color: rgba(0, 0, 0, 0.6) !important;
  }

  .dark .modal {
    background-color: #1e293b;
    color: #f1f5f9;
  }
  /* Improved styling for Question Accuracy header */
  html:not(.dark) .question-accuracy thead th {
  color: #000 !important;

}
html:not(.dark) .problem-distribution-header {
  color: #4f46e5; /* Light mode: Indigo-600 */
}

html.dark .problem-distribution-header {
  color: #cbd5e1; /* Dark mode: slate-300-ish */

  
}
#levelUpModal {
  background-color: rgba(255, 255, 255, 0.7); /* light mode backdrop */
  color: #1e293b; /* dark text for light mode */
}

.dark #levelUpModal {
  background-color: rgba(0, 0, 0, 0.6); /* dark mode backdrop */
  color: #f1f5f9;
}

#levelUpModal > div {
  background-color: white; /* light mode modal bg */
  color: #1e293b;
}

.dark #levelUpModal > div {
  background-color: #1e293b; /* dark mode modal bg */
  color: #f1f5f9;
}
/* Light mode modal text */
#levelUpModal > div {
  color: #1e293b; /* dark text */
}

/* Dark mode modal text */
.dark #levelUpModal > div {
  color: #f1f5f9; /* light text */
}




</style>

</head>
<body class="bg-white text-gray-800 p-4 sm:p-6 min-h-screen">
  <div class="max-w-6xl mx-auto space-y-10">
    <header class="glass p-6 sm:p-8 rounded-[2rem] text-center shadow-xl">
  <h1 class="text-4xl font-bold text-blue-900 tracking-tight">ğŸ“š AMC8/10/12 Tracker</h1>
  <p class="text-sm text-blue-700 mt-2">Track your progress, earn badges, and level up your math skills!</p>

  <div class="mt-4 flex justify-center gap-3">
    <button onclick="toggleDarkMode()" class="bg-gray-200 hover:bg-gray-300 text-sm px-4 py-1 rounded-full transition dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600">
      ğŸŒ™ Toggle Dark Mode
    </button>
    <a href="newtest.html" class="text-sm text-blue-600 hover:underline">â„¹ï¸ About</a>
  </div>
</header>

    <section>
  <div class="mb-4 flex justify-center items-center gap-2">
    <label for="filterTestType" class="text-sm text-gray-700 font-medium">Filter by Test Type:</label>
    <select id="filterTestType" class="border border-blue-300 rounded px-2 py-1 text-sm">
      <option value="all">All</option>
      <option value="amc8">AMC 8</option>
      <option value="amc10">AMC 10</option>
      <option value="amc12">AMC 12</option>
    </select>
  </div>
</section>
    <main class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <section class="glass p-6 rounded-2xl shadow-xl">
        <h2 class="text-xl font-semibold text-blue-700 mb-4">ğŸ® Gamification Panel</h2>
        <div class="flex justify-between items-center mb-3">
          <div class="text-lg">ğŸ”¥ <strong>Streak:</strong> <span id="streakCount">0</span> days</div>
          <div class="text-lg">
            â­ <strong>XP:</strong> <span id="xpCount">0</span><br>
            <div class="mt-4 text-lg">
  ğŸ§© <strong>Level:</strong> <span id="levelCount">1</span>
</div>


          </div>
        </div>
        <div class="w-full bg-gray-200 h-6 rounded-full overflow-hidden">
          <div id="xpProgressBar" class="bg-gradient-to-r from-blue-500 to-indigo-600 h-full text-white text-sm text-center leading-6 transition-all duration-300 ease-in-out">0%</div>
        </div>
        <div class="text-sm text-gray-600 mt-2 text-right">ğŸ¯ Daily XP Goal: <span id="dailyGoal">100</span> XP</div>

        <!-- Wheel Chart Section -->
        <div class="mt-6 problem-distribution-container">
  <h3 class="problem-distribution-header text-md font-semibold mb-2">
  ğŸ“Œ Problem Distribution
</h3>

  <div class="w-full max-w-md mx-auto">
    <canvas id="problemWheel" class="w-full h-auto"></canvas>
  </div>
</div>

      </section>

      <section class="glass p-6 rounded-2xl shadow-xl">
        <h2 class="text-xl font-semibold text-blue-700 mb-4">ğŸ“„ New Test Entry</h2>
        <div class="space-y-4">
          <select id="testType" class="w-full border border-blue-300 rounded p-2">
            <option value="amc8">AMC 8</option>
            <option value="amc10">AMC 10</option>
            <option value="amc12">AMC 12</option>
          </select>

          <input type="number" id="testYear" min="2000" max="2099" class="w-full border border-blue-300 rounded p-2" placeholder="Enter Year (e.g., 2025)">

          <textarea id="userAnswers" rows="2" oninput="sanitizeInput(this)" class="w-full border border-blue-300 rounded p-2" placeholder="Enter Your Answers (25 letters Aâ€“E only)"></textarea>

          <textarea id="answerKeyInput" rows="2" oninput="sanitizeInput(this)" class="w-full border border-blue-300 rounded p-2" placeholder="Enter Official Answer Key (25 letters Aâ€“E only)"></textarea>

          <div class="flex items-center justify-between">
            <button onclick="autoExtractAoPS()" class="text-sm text-blue-600 hover:underline hover-scale">âœ¨ Auto-Extract from AoPS</button>
            <button onclick="gradeTest()" class="bg-blue-600 text-white px-4 py-2 rounded-full hover:scale-105 hover:bg-blue-700 transition">Grade Test</button>
          </div>

          <div id="result" class="mt-2 text-green-700 font-semibold"></div>
        </div>
      </section>

      <section class="glass p-6 rounded-2xl shadow-xl">
        <h2 class="text-xl font-semibold text-indigo-700 mb-4">ğŸ“Š Test Statistics</h2>
        <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
          <li>Total Tests Taken: <span id="stat-total">0</span></li>
          <li>Last Test Date: <span id="stat-last">â€”</span></li>
          <li>Average Score: <span id="stat-avg">â€”</span></li>
          <li>Best Score: <span id="stat-best">â€”</span></li>
        </ul>
      </section>

      <section class="glass p-6 rounded-2xl shadow-xl">
        <h2 class="text-xl font-semibold text-yellow-700 mb-4">ğŸ… Badges Earned</h2>
        <div id="badges" class="flex gap-3 items-center flex-wrap text-2xl">No badges yet</div>
      </section>

      <section class="glass p-6 rounded-2xl shadow-xl col-span-1 lg:col-span-2">
        <h2 class="text-xl font-semibold text-blue-700 mb-2">ğŸ“ Past Tests</h2>
        <div class="max-h-64 overflow-y-auto">
          <table class="w-full table-auto text-sm text-gray-700">
            <thead>
              <tr>
                <th class="px-3 py-2 text-left">Date</th>
                <th class="px-3 py-2 text-left">Score</th>
                <th class="px-3 py-2 text-left">Percent</th>
                <th class="px-3 py-2 text-left">Test Type</th>
                <th class="px-3 py-2 text-left">Year</th>
              </tr>
            </thead>
            <tbody id="pastTestsBody" class="divide-y divide-gray-200"></tbody>
          </table>
          <p id="noTestsMsg" class="text-gray-500 mt-2 text-center">ğŸ“­ No tests yet â€” start solving!</p>
        </div>
      </section>

      <section class="glass p-6 rounded-2xl shadow-xl col-span-1 lg:col-span-2">
        

        <h2 class="text-xl font-semibold text-blue-700 mb-4">ğŸ“ˆ Score Progress</h2>
        <canvas id="scoreChart" height="150"></canvas>
      </section>
      <section class="glass p-6 rounded-2xl shadow-xl col-span-1 lg:col-span-2">
  <h2 class="text-xl font-semibold text-green-700 mb-4">ğŸ“Œ Question Accuracy</h2>
  <div class="overflow-x-auto">
    <table class="w-full table-auto text-sm text-center question-accuracy">



      <thead class="bg-blue-100">
  <tr>
    <th class="px-2 py-1 text-black dark:text-blue-200">Q#</th>
    <th class="px-2 py-1 text-black dark:text-blue-200">Correct</th>
    <th class="px-2 py-1 text-black dark:text-blue-200">Total</th>
    <th class="px-2 py-1 text-black dark:text-blue-200">Accuracy (%)</th>
  </tr>
</thead>


      <tbody id="questionAccuracyBody" class="divide-y divide-gray-200"></tbody>
    </table>
  </div>
</section>

      <div class="text-center col-span-full">
        <button onclick="clearData()" class="text-sm text-red-600 hover:underline hover-scale">ğŸ”„ Reset All Data</button>
      </div>
    </main>
  </div>
  <!-- JavaScript Logic -->
  <script>
    
    const xpEl = document.getElementById("xpCount");
    const streakEl = document.getElementById("streakCount");
    const totalEl = document.getElementById("stat-total");
    const lastEl = document.getElementById("stat-last");
    const avgEl = document.getElementById("stat-avg");
    const bestEl = document.getElementById("stat-best");
    const badgeEl = document.getElementById("badges");
    const xpProgressBar = document.getElementById("xpProgressBar");
    const dailyGoal = 100;
    const pastTestsBody = document.getElementById("pastTestsBody");
    const noTestsMsg = document.getElementById("noTestsMsg");
    let scores = JSON.parse(localStorage.getItem("scores") || "[]");
    const problemWheel = document.getElementById("problemWheel").getContext("2d");
    let totalCorrect = 0;
    let totalWrong = 0;
    let questionStats = JSON.parse(localStorage.getItem("questionStats") || "[]");
if (questionStats.length !== 25) {
  questionStats = Array(25).fill().map(() => ({ correct: 0, total: 0 }));
}
    let xp = parseInt(localStorage.getItem("xp") || "0");
    let prevLevel = parseInt(localStorage.getItem("prevLevel") || "1");
    let currentFilter = "all";

document.getElementById("filterTestType").addEventListener("change", (e) => {
  currentFilter = e.target.value;
  renderChart();
  renderQuestionAccuracy();
  updateWheel();
});


     function updateWheel() {
  const isDark = document.documentElement.classList.contains("dark");
  const filteredScores = currentFilter === "all" ? scores : scores.filter(s => s.testType === currentFilter);
  let correct = 0, wrong = 0;

  for (const s of filteredScores) {
    correct += s.score;
    wrong += 25 - s.score;
  }

  const totalProblems = correct + wrong;
  const hasData = totalProblems > 0;

  const wheelData = {
    labels: ["Correct", "Incorrect"],
    datasets: [{
      data: hasData ? [correct, wrong] : [1],
      backgroundColor: hasData
        ? (isDark ? ["#22c55e", "#f87171"] : ["#10b981", "#ef4444"]) // âœ… Different colors in dark/light
        : ["#d1d5db"],
      borderColor: "#ffffff",
      borderWidth: 2
    }]
  };

  if (window.problemChart) window.problemChart.destroy();

  window.problemChart = new Chart(problemWheel, {
    type: "doughnut",
    data: wheelData,
    options: {
      maintainAspectRatio: true,
      aspectRatio: 1,
      cutout: "70%",
      plugins: {
        legend: {
          labels: {
            color: isDark ? "#f8fafc" : "#1e293b"  // âœ… Label color based on theme
          },
          position: "bottom"
        }
      }
    }
  });
}

updateWheel();
    const originalGradeTest = gradeTest;

    function updateStreak() {
      const today = new Date().toISOString().split("T")[0];
      const lastDate = localStorage.getItem("lastPracticeDate");
      let streak = parseInt(localStorage.getItem("streak") || "0");

      if (lastDate !== today) {
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yStr = yesterday.toISOString().split("T")[0];
        streak = lastDate === yStr ? streak + 1 : 1;
        localStorage.setItem("lastPracticeDate", today);
        localStorage.setItem("streak", streak);
      }

      streakEl.textContent = streak;
    }
    function showLevelUpModal(level) {
  document.getElementById("newLevelText").textContent = `Level ${level}`;
  document.getElementById("levelUpModal").classList.remove("hidden");

  // Optional: Confetti using canvas-confetti CDN
  if (typeof confetti === "function") {
    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
  }
}

function closeLevelUpModal() {
  document.getElementById("levelUpModal").classList.add("hidden");
}

    function updateXP(amount) {
  let xp = parseInt(localStorage.getItem("xp") || "0");
  xp += amount;
  localStorage.setItem("xp", xp);
  xpEl.textContent = xp;

  const percent = Math.min(100, Math.round((xp % dailyGoal) / dailyGoal * 100));
  xpProgressBar.style.width = percent + "%";
  xpProgressBar.textContent = percent + "%";

  const level = Math.floor(xp / 100) + 1;
  document.getElementById("levelCount").textContent = level;

  if (level > prevLevel) {
    showLevelUpModal(level);
    localStorage.setItem("prevLevel", level);
    prevLevel = level;
  }
}


    function updateStats() {
      const total = scores.length;
      const best = Math.max(...scores.map(s => s.score), 0);
      const avg = scores.reduce((acc, s) => acc + s.score, 0) / (scores.length || 1);
      const last = scores.length ? scores[scores.length - 1].date : "â€”";

      totalEl.textContent = total;
      bestEl.textContent = best;
      avgEl.textContent = Math.round(avg * 100) / 100;
      lastEl.textContent = last;
    }

    function gradeTest() {
  const input = document.getElementById("userAnswers").value.trim().toUpperCase();
  const key = document.getElementById("answerKeyInput").value.trim().toUpperCase();
  const testType = document.getElementById("testType").value;
  const testYear = document.getElementById("testYear").value || new Date().getFullYear();

  if (input.length !== 25 || key.length !== 25) {
    document.getElementById("result").innerHTML = `âŒ You must enter exactly 25 characters in both fields (Aâ€“E only).`;
    return;
  }

  let correct = 0;
  for (let i = 0; i < 25; i++) {
    if (input[i] === key[i]) correct++;
  }
let incorrectIndexes = [];

for (let i = 0; i < 25; i++) {
  if (input[i] === key[i]) {
    questionStats[i].correct++;
  } else {
    incorrectIndexes.push(i + 1); // 1-based index
  }
  questionStats[i].total++;
}

localStorage.setItem("questionStats", JSON.stringify(questionStats));
renderQuestionAccuracy();

  const incorrect = 25 - correct;
  const percent = Math.round((correct / 25) * 100);
  const score = correct;
  const date = new Date().toISOString().split("T")[0];

  scores.push({ date, score, testType, year: parseInt(testYear), wrong: incorrectIndexes, input, key });

  localStorage.setItem("scores", JSON.stringify(scores));

  document.getElementById("result").innerHTML = `âœ… You scored <strong>${score}</strong> out of <strong>25</strong>.<br>âœ”ï¸ Correct: ${correct} | âŒ Incorrect: ${incorrect} | ğŸ“ˆ ${percent}%`;

  // Update wheel chart
  totalCorrect += correct;
  totalWrong += incorrect;
  updateWheel();

  // Update gamification & statistics
  updateStreak();
  updateXP(10 + correct); // XP bonus: 10 base + 1 per correct answer
  updateStats();
  renderChart();
  updateBadges(score);
  renderPastTests();
}

    function sanitizeInput(textarea) {
      textarea.value = textarea.value.toUpperCase().replace(/[^ABCDE]/g, '').slice(0, 25);
    }

    function clearData() {
  if (confirm("Are you sure you want to reset all saved data?")) {
    localStorage.removeItem("scores");
    localStorage.removeItem("xp");
    localStorage.removeItem("streak");
    localStorage.removeItem("lastPracticeDate");
    localStorage.removeItem("questionStats"); // âœ… This line resets question accuracy
    location.reload();
  }
}


    function autoExtractAoPS() {
      const input = document.getElementById("answerKeyInput").value;
      const matches = input.toUpperCase().match(/[ABCDE]/g);
      if (matches && matches.length >= 25) {
        document.getElementById("answerKeyInput").value = matches.slice(0, 25).join("");
        alert("âœ… Answer key extracted successfully!");
      } else {
        alert("âŒ Couldn't extract 25 valid answers from input.");
      }
    }

    function updateBadges(latestScore) {
      const streak = parseInt(localStorage.getItem("streak") || "0");
      let badges = [];

      if (streak >= 3) badges.push({ emoji: "ğŸ¥‰", title: "3-Day Streak" });
      if (streak >= 7) badges.push({ emoji: "ğŸ¥ˆ", title: "7-Day Streak" });
      if (streak >= 30) badges.push({ emoji: "ğŸ¥‡", title: "30-Day Streak" });
      if (streak >= 100) badges.push({ emoji: "ğŸ”¥", title: "100-Day Streak" });
      if (latestScore === 25) badges.push({ emoji: "ğŸ’¯", title: "Perfect Score" });
      if (scores.length > 1) {
        const prevScore = scores[scores.length - 2].score;
        if (latestScore - prevScore >= 5) badges.push({ emoji: "ğŸš€", title: "Big Improvement" });
        if (latestScore === prevScore) badges.push({ emoji: "ğŸ¯", title: "Consistent Score" });
      }
      const best = Math.max(...scores.map(s => s.score), 0);
      if (latestScore === best && latestScore !== 0) badges.push({ emoji: "â«", title: "New Personal Best" });
      if (latestScore >= 20) badges.push({ emoji: "ğŸ§ ", title: "High Score" });
      const totalTests = scores.length;
      if (totalTests >= 5) badges.push({ emoji: "ğŸ“š", title: "5 Tests Taken" });
      if (totalTests >= 10) badges.push({ emoji: "ğŸ“", title: "10 Tests Taken" });
      if (totalTests >= 25) badges.push({ emoji: "ğŸ§ª", title: "25 Tests Taken" });

      badgeEl.innerHTML = badges.length
        ? badges.map(b => `
            <div class="relative group hover-scale">
              <span class="cursor-pointer">${b.emoji}</span>
              <div class="tooltip">${b.title}</div>
            </div>
          `).join("")
        : "<p class='text-sm text-gray-500'>No badges yet</p>";
    }

    function renderChart() {
  const isDark = document.documentElement.classList.contains('dark');
  const ctx = document.getElementById("scoreChart").getContext("2d");
  const filteredScores = currentFilter === "all" ? scores : scores.filter(s => s.testType === currentFilter);

  const labels = filteredScores.map(s => s.date);
  const data = filteredScores.map(s => s.score);

  if (window.chart) window.chart.destroy();

  window.chart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [{
        label: "Score",
        data,
        borderColor: "#2563eb",
        backgroundColor: "rgba(37,99,235,0.1)",
        tension: 0.2,
        fill: true
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          max: 25,
          ticks: {
            color: isDark ? '#f8fafc' : '#000'
          },
          grid: {
            color: isDark ? '#334155' : '#e5e7eb'
          }
        },
        x: {
          ticks: {
            color: isDark ? '#f8fafc' : '#000'
          },
          grid: {
            color: isDark ? '#334155' : '#e5e7eb'
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            color: isDark ? '#f8fafc' : '#000'
          }
        },
        tooltip: {
          backgroundColor: isDark ? '#1e293b' : 'rgba(0, 0, 0, 0.8)',
          titleColor: '#f8fafc',
          bodyColor: '#f1f5f9',
          borderColor: '#64748b',
          borderWidth: 1
        }
      }
    }
  });
}


    function renderPastTests() {
  if (scores.length === 0) {
    noTestsMsg.style.display = "block";
    pastTestsBody.innerHTML = "";
    return;
  }

  noTestsMsg.style.display = "none";

  pastTestsBody.innerHTML = scores
    .map(t => {
      const percent = Math.round((t.score / 25) * 100);
      const dateStr = t.date;
      const testTypeLabel = t.testType ? t.testType.toUpperCase() : "-";

      return `
        <tr class="hover:bg-blue-50 transition">
          <td class="px-3 py-1">${dateStr}</td>
          <td class="px-3 py-1">${t.score} / 25</td>
          <td class="px-3 py-1">${percent}%</td>
          <td class="px-3 py-1 capitalize">${testTypeLabel}</td>
          <td class="px-3 py-1">${t.year || 'â€”'}</td>
        </tr>
      `;
    })
    .join("");
}


    function renderQuestionAccuracy() {
  const filteredScores = currentFilter === "all" ? scores : scores.filter(s => s.testType === currentFilter);
  const stats = Array(25).fill().map(() => ({ correct: 0, total: 0 }));

  for (const s of filteredScores) {
    const input = s.input || ""; // Ensure input exists
    const key = s.key || "";
    for (let i = 0; i < 25; i++) {
      if (!input[i] || !key[i]) continue;
      stats[i].total++;
      if (input[i] === key[i]) stats[i].correct++;
    }
  }

  const tbody = document.getElementById("questionAccuracyBody");
  tbody.innerHTML = stats.map((q, i) => {
    const accuracy = q.total ? Math.round((q.correct / q.total) * 100) : 'â€”';
    return `
      <tr>
        <td class="px-2 py-1 font-medium">${i + 1}</td>
        <td class="px-2 py-1 text-green-700">${q.correct}</td>
        <td class="px-2 py-1">${q.total}</td>
        <td class="px-2 py-1">${accuracy}%</td>
      </tr>
    `;
  }).join('');
}
    function toggleDarkMode() {
  document.documentElement.classList.toggle('dark');
  localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');

  renderChart();
  updateWheel();

  // Force a repaint so modal color updates immediately
  const modal = document.getElementById("levelUpModal");
  if (!modal.classList.contains("hidden")) {
    modal.classList.add("hidden");
    requestAnimationFrame(() => modal.classList.remove("hidden"));
  }
}


// On page load, check saved theme
if (localStorage.getItem('theme') === 'dark') {
  document.documentElement.classList.add('dark');
}


    // Init
    updateStreak();
    xpEl.textContent = localStorage.getItem("xp") || "0";
    updateXP(0);
    document.getElementById("levelCount").textContent = Math.floor((parseInt(localStorage.getItem("xp") || "0")) / 100) + 1;
    updateStats();
    renderChart();
    const latest = scores[scores.length - 1]?.score || 0;
    updateBadges(latest);
    renderPastTests();
    renderQuestionAccuracy();

  </script>
<div id="levelUpModal" class="fixed inset-0 bg-white/70 dark:bg-black/60 flex items-center justify-center z-50 hidden">
  <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl max-w-xs w-full flex flex-col items-center text-center">
    <h2 class="text-2xl font-bold mb-2">ğŸ‰ Level Up!</h2>
    <p class="text-lg mb-4">
      You reached <strong id="newLevelText">Level 1</strong>!
    </p>
    <button onclick="closeLevelUpModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700">Close</button>
  </div>
</div>




</body>
</html>
